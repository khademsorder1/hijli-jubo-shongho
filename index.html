<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>লগইন - হিজলী দিঘাপাড়া যুব সংঘ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap');
        :root { --primary-color: #16a085; --secondary-color: #27ae60; --dark-text: #2c3e50; --light-text: #7f8c8d; --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); --error-color: #e74c3c; --success-color: #27ae60; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Hind Siliguri', sans-serif; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        #page-loader { color: white; text-align: center; }
        .spinner { border: 5px solid rgba(255, 255, 255, 0.3); border-top: 5px solid #fff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .login-container { background-color: white; border-radius: 15px; box-shadow: var(--card-shadow); width: 100%; max-width: 420px; display: none; overflow: hidden; }
        .header { padding: 30px; text-align: center; }
        .header h1 { font-size: 1.8rem; margin-bottom: 5px; }
        .highlight { color: var(--primary-color); background: linear-gradient(to right, #1abc9c, #16a085); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; }
        .main-content { padding: 30px; }
        .login-toggle { display: flex; justify-content: center; margin-bottom: 20px; background-color: #ecf0f1; border-radius: 10px; padding: 5px; }
        .login-toggle button { flex: 1; padding: 10px; border: none; background-color: transparent; font-size: 1rem; font-weight: 600; cursor: pointer; border-radius: 8px; transition: all 0.3s ease; }
        .login-toggle button.active { background-color: white; color: var(--primary-color); box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-control { margin-bottom: 5px; position: relative; }
        .form-control i.fa-solid:not(.toggle-password) { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--light-text); transition: color 0.3s; }
        .form-control .toggle-password { position: absolute; right: 18px; top: 50%; transform: translateY(-50%); color: var(--light-text); cursor: pointer; }
        .form-control input { width: 100%; padding: 14px 50px; border: 2px solid #e0e0e0; background-color: #f9f9f9; border-radius: 10px; font-family: 'Hind Siliguri', sans-serif; font-size: 1rem; transition: all 0.3s ease; }
        .form-control input:focus { outline: none; border-color: var(--primary-color); background-color: white; box-shadow: 0 0 0 4px rgba(22, 160, 133, 0.1); }
        .form-control input:focus ~ i.fa-solid { color: var(--primary-color); }
        .phone-input-group { display: flex; }
        .phone-input-group .country-code { padding: 14px; background-color: #ecf0f1; border: 2px solid #e0e0e0; border-right: none; border-radius: 10px 0 0 10px; font-weight: 600; }
        .phone-input-group input { border-radius: 0 10px 10px 0; padding-left: 15px; }
        .form-guideline { font-size: 0.8rem; color: var(--light-text); text-align: left; margin: 5px 0 15px 5px; }
        #password-requirements, #phone-requirements { margin: 5px 0 15px 5px; text-align: left; display: none; }
        #password-requirements li, #phone-requirements li { list-style: none; font-size: 0.8rem; margin-bottom: 4px; color: var(--error-color); }
        #password-requirements li.valid, #phone-requirements li.valid { color: var(--success-color); }
        #password-requirements li i, #phone-requirements li i { margin-right: 8px; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 10px; color: white; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn:disabled { background-color: #bdc3c7; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-primary { background-color: var(--primary-color); }
        #toggle-mode-btn { background: none; color: var(--primary-color); font-weight: 600; text-align: center; display: block; width: 100%; cursor: pointer; border: none; font-size: 1rem; padding: 10px 0; }
        .alternative-login p { color: var(--light-text); margin-bottom: 15px; position: relative; }
        .alternative-login p::before, .alternative-login p::after { content: ''; position: absolute; top: 50%; width: 35%; height: 1px; background-color: #ddd; }
        .alternative-login p::before { left: 0; } .alternative-login p::after { right: 0; }
        .btn-group { display: flex; gap: 15px; }
        .btn-alt { flex: 1; padding: 12px; border-radius: 10px; cursor: pointer; font-size: 0.9rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; border: 2px solid #e0e0e0; background-color: #f9f9f9; transition: all 0.3s ease; }
        .btn-alt:hover { border-color: var(--primary-color); background-color: white; }
        .btn-google { color: #db4437; }
        .btn-guest { color: var(--dark-text); }
        .footer { text-align: center; padding: 20px; background-color: #f8f9fa; border-top: 1px solid #eee; color: var(--light-text); font-size: 0.9rem; }
        .message-box { text-align: center; margin-top: 15px; font-weight: 500; display: none; padding: 12px; border-radius: 8px; line-height: 1.5; }
        .error-message { color: var(--error-color); background-color: #fadbd8; }
        .success-message { color: var(--success-color); background-color: #d4efdf; }
        .action-link { color: var(--primary-color); font-weight: bold; cursor: pointer; text-decoration: underline; }
        .loader-small { width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.4); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
    </style>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d6efd">

</head>
<body>
    <div id="page-loader"><div class="spinner"></div><p>সংযোগ স্থাপন করা হচ্ছে...</p></div>

    <div class="login-container" id="login-container">
        <header class="header"><h1><span class="highlight">হিজলী দিঘাপাড়া যুব সংঘ</span></h1></header>
        <main class="main-content">
            <h2 id="form-title" style="text-align:center; color: var(--dark-text); margin-bottom:20px;">লগইন করুন</h2>
            <div class="login-toggle">
                <button id="email-tab" class="active">ইমেইল</button>
                <button id="phone-tab">ফোন নম্বর</button>
            </div>
            <form id="auth-form">
                <div id="email-group">
                    <div class="form-control"><i class="fa-solid fa-envelope"></i><input type="email" id="email" placeholder="ইমেইল দিন"></div>
                    <p class="form-guideline">শুধুমাত্র @gmail.com বা @outlook.com গ্রহণযোগ্য।</p>
                </div>
                <div id="phone-group" style="display: none;">
                    <div class="form-control phone-input-group">
                        <span class="country-code">+880</span><input type="tel" id="phone" placeholder="1xxxxxxxxx">
                    </div>
                     <ul id="phone-requirements">
                        <li id="phone-length"><i class="fa-solid fa-times-circle"></i>১১ ডিজিটের নম্বর (শুরুতে 0 ছাড়া)</li>
                        <li id="phone-start"><i class="fa-solid fa-times-circle"></i>নম্বরটি 1 দিয়ে শুরু হবে</li>
                    </ul>
                </div>
                <div class="form-control"><i class="fa-solid fa-lock"></i><input type="password" id="password" placeholder="পাসওয়ার্ড দিন" required><i class="fa-solid fa-eye toggle-password"></i></div>
                <ul id="password-requirements">
                    <li id="length"><i class="fa-solid fa-times-circle"></i>কমপক্ষে ৬ অক্ষর</li>
                    <li id="uppercase"><i class="fa-solid fa-times-circle"></i>বড় হাতের অক্ষর (A-Z)</li>
                    <li id="lowercase"><i class="fa-solid fa-times-circle"></i>ছোট হাতের অক্ষর (a-z)</li>
                    <li id="number"><i class="fa-solid fa-times-circle"></i>নম্বর (0-9)</li>
                    <li id="special"><i class="fa-solid fa-times-circle"></i>স্পেশাল ক্যারেক্টার (!@#$%)</li>
                </ul>
                <div id="confirm-password-group" style="display: none;">
                    <div class="form-control"><i class="fa-solid fa-lock"></i><input type="password" id="confirm-password" placeholder="পুনরায় পাসওয়ার্ড দিন"><i class="fa-solid fa-eye toggle-password"></i></div>
                </div>
                <button type="submit" class="btn btn-primary" id="submit-btn">লগইন করুন</button>
            </form>
            <button id="toggle-mode-btn">অ্যাকাউন্ট নেই? তৈরি করুন</button>
            <div class="message-box" id="message-box"></div>
            <div class="alternative-login">
                <p>অথবা</p>
                <div class="btn-group">
                    <button class="btn-alt btn-google" id="google-login-btn"><i class="fab fa-google"></i><span>Google</span></button>
                    <button class="btn-alt btn-guest" id="guest-login-btn"><i class="fas fa-user-secret"></i><span>Guest</span></button>
                </div>
            </div>
        </main>
        <footer class="footer">সর্বস্বত্ব সংরক্ষিত © ২০২৬ হিজলী দিঘাপাড়া যুব সংঘ</footer>
    </div>
    <div id="recaptcha-container" style="position: fixed; bottom: 0; right: 0; z-index: -1;"></div>
    <div class="login-container" id="success-container" style="display: none; padding: 40px; text-align:center;"><i class="fas fa-envelope-circle-check" style="color: var(--success-color); font-size: 50px;"></i><h2 style="color: var(--success-color); margin-top:20px;">অ্যাকাউন্ট সফলভাবে তৈরি হয়েছে!</h2><p style="color: var(--dark-text); font-size: 1.1rem; line-height: 1.6;">আপনার ইমেইল ইনবক্সে একটি ভেরিফিকেশন লিংক পাঠানো হয়েছে। অনুগ্রহ করে লিংকে ক্লিক করে আপনার অ্যাকাউন্টটি সক্রিয় করুন।</p><button class="btn btn-primary" style="margin-top: 20px;" onclick="window.location.reload()">লগইন পেজে ফিরে যান</button></div>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const firebaseConfig = { apiKey: "AIzaSyDerc9e0-e7WBnkK2GoinFejp7zszXJ3Jc", authDomain: "songho-8ef5c.firebaseapp.com", projectId: "songho-8ef5c", storageBucket: "songho-8ef5c.appspot.com", messagingSenderId: "489031747232", appId: "1:489031747232:web:4c1cde63dabaa620ed2bc5", measurementId: "G-5NY15E3XJJ" };
            
            const pageLoader = document.getElementById('page-loader'), loginContainer = document.getElementById('login-container'), successContainer = document.getElementById('success-container'), authForm = document.getElementById('auth-form'), emailInput = document.getElementById('email'), passwordInput = document.getElementById('password'), confirmPasswordGroup = document.getElementById('confirm-password-group'), confirmPasswordInput = document.getElementById('confirm-password'), passwordRequirements = document.getElementById('password-requirements'), googleLoginBtn = document.getElementById('google-login-btn'), guestLoginBtn = document.getElementById('guest-login-btn'), messageBox = document.getElementById('message-box'), toggleModeBtn = document.getElementById('toggle-mode-btn'), formTitle = document.getElementById('form-title'), submitBtn = document.getElementById('submit-btn'), emailTab = document.getElementById('email-tab'), phoneTab = document.getElementById('phone-tab'), emailGroup = document.getElementById('email-group'), phoneGroup = document.getElementById('phone-group'), phoneInput = document.getElementById('phone'), phoneRequirements = document.getElementById('phone-requirements');
            let isLoginMode = true, loginMethod = 'email', unverifiedUser = null;

            try {
                const app = firebase.initializeApp(firebaseConfig);
                const auth = firebase.auth();
                const db = firebase.firestore();

                auth.onAuthStateChanged(user => {
                    if (user && (user.emailVerified || user.isAnonymous || user.phoneNumber)) { window.location.replace('user.html'); } 
                    else { pageLoader.style.display = 'none'; loginContainer.style.display = 'block'; }
                });

                emailTab.addEventListener('click', () => switchLoginMethod('email'));
                phoneTab.addEventListener('click', () => switchLoginMethod('phone'));
                authForm.addEventListener('submit', handleFormSubmit);
                googleLoginBtn.addEventListener('click', handleGoogleLogin);
                guestLoginBtn.addEventListener('click', () => { window.location.href = 'guest-profile.html'; });
                toggleModeBtn.addEventListener('click', toggleMode);
                passwordInput.addEventListener('keyup', validatePassword);
                phoneInput.addEventListener('keyup', validatePhone);
                document.querySelectorAll('.toggle-password').forEach(item => {
                    item.addEventListener('click', e => {
                        const input = e.target.closest('.form-control').querySelector('input');
                        input.type = input.type === 'password' ? 'text' : 'password';
                        e.target.classList.toggle('fa-eye'); e.target.classList.toggle('fa-eye-slash');
                    });
                });

                function switchLoginMethod(method) {
                    loginMethod = method;
                    showMessage(''); authForm.reset();
                    emailTab.classList.toggle('active', method === 'email');
                    phoneTab.classList.toggle('active', method === 'phone');
                    emailGroup.style.display = method === 'email' ? 'block' : 'none';
                    phoneGroup.style.display = method === 'phone' ? 'block' : 'none';
                    passwordRequirements.style.display = isLoginMode ? 'none' : 'block';
                    phoneRequirements.style.display = (method === 'phone' && !isLoginMode) ? 'block' : 'none';
                    emailInput.required = method === 'email';
                    phoneInput.required = method === 'phone';
                }

                function toggleMode() {
                    isLoginMode = !isLoginMode;
                    showMessage(''); authForm.reset();
                    formTitle.textContent = isLoginMode ? 'লগইন করুন' : 'অ্যাকাউন্ট তৈরি করুন';
                    submitBtn.innerHTML = isLoginMode ? 'লগইন করুন' : 'অ্যাকাউন্ট তৈরি করুন';
                    toggleModeBtn.textContent = isLoginMode ? 'অ্যাকাউন্ট নেই? তৈরি করুন' : 'ইতিমধ্যে অ্যাকাউন্ট আছে? লগইন করুন';
                    confirmPasswordGroup.style.display = isLoginMode ? 'none' : 'block';
                    passwordRequirements.style.display = isLoginMode ? 'none' : 'block';
                    phoneRequirements.style.display = (loginMethod === 'phone' && !isLoginMode) ? 'block' : 'none';
                    confirmPasswordInput.required = !isLoginMode;
                }

                function handleFormSubmit(e) {
                    e.preventDefault();
                    if (loginMethod === 'email') {
                        if (isLoginMode) handleEmailLogin(); else handleEmailSignup();
                    } else {
                        alert("ফোন নম্বর দিয়ে লগইন/সাইনআপ আপাতত বন্ধ আছে।");
                        // Future implementation for phone auth
                    }
                }

                async function handleEmailLogin() {
                    toggleLoading(true); showMessage('');
                    if (!validateEmail(emailInput.value)) { showMessage("অনুগ্রহ করে একটি সঠিক @gmail.com বা @outlook.com ইমেইল দিন।", 'error'); toggleLoading(false); return; }
                    try {
                        const userCredential = await auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value);
                        if (!userCredential.user.emailVerified) {
                            unverifiedUser = userCredential.user;
                            await auth.signOut();
                            showMessage("আপনার ইমেইল ভেরিফাই করা হয়নি। <span class='action-link' onclick='window.resendVerification()'>আবার পাঠান</span>", 'error');
                        }
                    } catch (error) { handleAuthError(error); } 
                    finally { toggleLoading(false); }
                }

                async function handleEmailSignup() {
                    toggleLoading(true); showMessage('');
                    if (!validateEmail(emailInput.value)) { showMessage("শুধুমাত্র @gmail.com বা @outlook.com ইমেইল গ্রহণযোগ্য।", 'error'); toggleLoading(false); return; }
                    if (!isPasswordValid(passwordInput.value)) { showMessage("অনুগ্রহ করে পাসওয়ার্ডের সব শর্ত পূরণ করুন।", 'error'); toggleLoading(false); return; }
                    if (passwordInput.value !== confirmPasswordInput.value) { showMessage("দুটি পাসওয়ার্ড মেলেনি।", 'error'); toggleLoading(false); return; }
                    try {
                        const userCredential = await auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value);
                        await userCredential.user.sendEmailVerification();
                        await auth.signOut();
                        loginContainer.style.display = 'none';
                        successContainer.style.display = 'block';
                    } catch (error) { handleAuthError(error); } 
                    finally { toggleLoading(false); }
                }

                window.resendVerification = async () => { if (unverifiedUser) { try { await unverifiedUser.sendEmailVerification(); showMessage("একটি নতুন ভেরিফিকেশন ইমেইল পাঠানো হয়েছে।", 'success'); } catch (error) { showMessage("ইমেইল পাঠাতে সমস্যা হয়েছে।", 'error'); } } };
                window.resetPassword = async () => { const email = emailInput.value; if (!email) { showMessage("পাসওয়ার্ড রিসেট করার জন্য অনুগ্রহ করে আপনার ইমেইলটি লিখুন।", "error"); return; } try { await auth.sendPasswordResetEmail(email); showMessage("পাসওয়ার্ড রিসেট করার জন্য আপনার ইমেইলে একটি লিংক পাঠানো হয়েছে।", "success"); } catch (error) { showMessage("পাসওয়ার্ড রিসেট ইমেইল পাঠাতে সমস্যা হয়েছে।", "error"); } };
                async function handleGoogleLogin() { showMessage(''); try { const provider = new firebase.auth.GoogleAuthProvider(); const result = await auth.signInWithPopup(provider); const user = result.user; const userDocRef = db.collection("members").doc(user.uid); const doc = await userDocRef.get(); if (!doc.exists) { window.location.href = 'complete-profile.html'; } } catch(error) { handleAuthError(error); } }
                
                function handleAuthError(error) {
                    let message = "একটি অজানা সমস্যা হয়েছে।";
                    switch (error.code) {
                        case 'auth/wrong-password': message = "আপনার পাসওয়ার্ডটি ভুল হয়েছে। <span class='action-link' onclick='window.resetPassword()'>রিসেট করুন</span>"; break;
                        case 'auth/user-not-found': message = "এই ইমেইল দিয়ে কোনো অ্যাকাউন্ট খুঁজে পাওয়া যায়নি।"; break;
                        case 'auth/email-already-in-use': message = "এই ইমেইল দিয়ে ইতিমধ্যে একটি অ্যাকাউন্ট তৈরি করা আছে।"; break;
                        case 'auth/weak-password': message = "পাসওয়ার্ডটি খুব দুর্বল। কমপক্ষে ৬ অক্ষরের হতে হবে।"; break;
                        case 'auth/invalid-email': message = "অনুগ্রহ করে একটি সঠিক ইমেইল ঠিকানা দিন।"; break;
                        case 'auth/network-request-failed': message = "ইন্টারনেট সংযোগে সমস্যা হয়েছে।"; break;
                    }
                    showMessage(message, 'error');
                }

                function showMessage(msg, type = 'error') { messageBox.innerHTML = msg; messageBox.className = `message-box ${type}-message`; messageBox.style.display = msg ? 'block' : 'none'; }
                function toggleLoading(isLoading) { submitBtn.disabled = isLoading; submitBtn.innerHTML = isLoading ? '<div class="loader-small"></div>' : (isLoginMode ? 'লগইন করুন' : 'অ্যাকাউন্ট তৈরি করুন'); }
                function validateEmail(email) { const validDomains = ['@gmail.com', '@outlook.com']; return validDomains.some(domain => email.endsWith(domain)); }
                function isPasswordValid(password) { return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*]).{6,}$/.test(password); }
                function validatePassword() { if(isLoginMode) return; const password = passwordInput.value; const checks = { length: password.length >= 6, uppercase: /[A-Z]/.test(password), lowercase: /[a-z]/.test(password), number: /\d/.test(password), special: /[!@#$%^&*]/.test(password), }; for (const key in checks) { const el = document.getElementById(key); el.classList.toggle('valid', checks[key]); el.querySelector('i').className = checks[key] ? 'fa-solid fa-check-circle' : 'fa-solid fa-times-circle'; } }
                function validatePhone() { const phone = phoneInput.value; const checks = { 'phone-length': phone.length === 10, 'phone-start': phone.startsWith('1') }; for (const key in checks) { const el = document.getElementById(key); el.classList.toggle('valid', checks[key]); el.querySelector('i').className = checks[key] ? 'fa-solid fa-check-circle' : 'fa-solid fa-times-circle'; } }
            } catch (error) {
                console.error("Firebase Initialization Failed:", error);
                pageLoader.innerHTML = `<p style="color:red; font-weight:bold;">সিস্টেম চালু হতে সমস্যা হচ্ছে।</p>`;
            }
        });

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}

    </script>
</body>
</html>