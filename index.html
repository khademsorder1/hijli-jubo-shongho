<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>লগইন - হিজলী দিঘাপাড়া যুব সংঘ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap');
        :root { --primary-color: #16a085; --secondary-color: #27ae60; --dark-text: #2c3e50; --light-text: #7f8c8d; --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); --error-color: #e74c3c; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Hind Siliguri', sans-serif; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        #page-loader { color: white; text-align: center; }
        .spinner { border: 5px solid rgba(255, 255, 255, 0.3); border-top: 5px solid #fff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .login-container { background-color: white; border-radius: 15px; box-shadow: var(--card-shadow); width: 100%; max-width: 420px; display: none; /* Hidden by default */ }
        .header { padding: 30px; text-align: center; }
        .header h1 { font-size: 1.8rem; margin-bottom: 5px; color: var(--primary-color); }
        .header p { font-size: 0.9rem; color: var(--light-text); }
        .header .established { display: inline-block; background-color: #ecf0f1; color: var(--dark-text); padding: 5px 15px; border-radius: 15px; font-weight: 500; margin-top: 10px; font-size: 0.9rem; }
        .main-content { padding: 30px; }
        .form-control { margin-bottom: 20px; position: relative; }
        .form-control i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--light-text); }
        .form-control input { width: 100%; padding: 12px 15px 12px 45px; border: 1px solid #ddd; border-radius: 8px; font-family: 'Hind Siliguri', sans-serif; font-size: 1rem; }
        .form-control input:focus { outline: none; border-color: var(--primary-color); }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; color: white; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s; }
        .btn:hover { transform: translateY(-2px); }
        .btn-primary { background-color: var(--primary-color); margin-bottom: 10px; }
        .btn-secondary { background: none; color: var(--primary-color); font-weight: 500; }
        .alternative-login { text-align: center; margin-top: 25px; }
        .alternative-login p { color: var(--light-text); margin-bottom: 15px; position: relative; }
        .alternative-login p::before, .alternative-login p::after { content: ''; position: absolute; top: 50%; width: 35%; height: 1px; background-color: #ddd; }
        .alternative-login p::before { left: 0; } .alternative-login p::after { right: 0; }
        .btn-group { display: flex; gap: 15px; }
        .btn-alt { flex: 1; padding: 10px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px; border: 1px solid #ddd; }
        .btn-google { background-color: #fff; color: #db4437; }
        .btn-guest { background-color: #fff; color: var(--dark-text); }
        .footer { text-align: center; padding: 20px; background-color: #f8f9fa; border-top: 1px solid #eee; color: var(--light-text); font-size: 0.9rem; }
        .error-message { color: var(--error-color); text-align: center; margin-top: 15px; font-weight: 500; display: none; }
    </style>
</head>
<body>
    <div id="page-loader">
        <div class="spinner"></div>
        <p>সংযোগ স্থাপন করা হচ্ছে...</p>
    </div>
    <div class="login-container" id="login-container">
        <header class="header">
            <h1>হিজলী দিঘাপাড়া যুব সংঘ</h1>
            <p>হিজলী দিঘাপাড়া, বাগাতিপাড়া, নাটোর</p>
            <div class="established">স্থাপিত: ২০২৬</div>
        </header>
        <main class="main-content">
            <form id="login-form">
                <div class="form-control"><i class="fas fa-envelope"></i><input type="email" id="email" placeholder="ইমেইল দিন" required></div>
                <div class="form-control"><i class="fas fa-lock"></i><input type="password" id="password" placeholder="পাসওয়ার্ড দিন" required></div>
                <button type="submit" class="btn btn-primary">লগইন করুন</button>
            </form>
            <button class="btn btn-secondary" id="signup-btn">অ্যাকাউন্ট তৈরি করুন</button>
            <p class="error-message" id="error-message"></p>
            <div class="alternative-login">
                <p>অথবা</p>
                <div class="btn-group">
                    <button class="btn-alt btn-google" id="google-login-btn"><i class="fab fa-google"></i><span>Google</span></button>
                    <button class="btn-alt btn-guest" id="guest-login-btn"><i class="fas fa-user-secret"></i><span>Guest</span></button>
                </div>
            </div>
        </main>
        <footer class="footer">সর্বস্বত্ব সংরক্ষিত © ২০২৬ হিজলী দিঘাপাড়া যুব সংঘ</footer>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // আপনার Firebase কনফিগারেশন
            const firebaseConfig = {
                apiKey: "AIzaSyDerc9e0-e7WBnkK2GoinFejp7zszXJ3Jc", authDomain: "songho-8ef5c.firebaseapp.com", projectId: "songho-8ef5c", storageBucket: "songho-8ef5c.appspot.com", messagingSenderId: "489031747232", appId: "1:489031747232:web:4c1cde63dabaa620ed2bc5", measurementId: "G-5NY15E3XJJ"
            };
            
            // --- DOM Elements ---
            const pageLoader = document.getElementById('page-loader');
            const loginContainer = document.getElementById('login-container');
            const loginForm = document.getElementById('login-form');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const signupBtn = document.getElementById('signup-btn');
            const googleLoginBtn = document.getElementById('google-login-btn');
            const guestLoginBtn = document.getElementById('guest-login-btn');
            const errorMessage = document.getElementById('error-message');
            
            try {
                // --- Initialize Firebase ---
                const app = firebase.initializeApp(firebaseConfig);
                const auth = firebase.auth();
                const db = firebase.firestore();

                // --- Auth State Observer ---
                auth.onAuthStateChanged(user => {
                    if (user) {
                        window.location.replace('user.html');
                    } else {
                        pageLoader.style.display = 'none';
                        loginContainer.style.display = 'block';
                    }
                });

                // --- Fallback Timer ---
                setTimeout(() => {
                    if (pageLoader.style.display !== 'none') {
                        pageLoader.innerHTML = '<p style="color:red; font-weight:bold;">সংযোগ স্থাপন করা সম্ভব হচ্ছে না।<br>আপনার ইন্টারনেট সংযোগ চেক করুন অথবা পৃষ্ঠাটি রিলোড করুন।</p>';
                    }
                }, 7000); // 7 seconds

                // --- Event Listeners ---
                loginForm.addEventListener('submit', handleEmailLogin);
                signupBtn.addEventListener('click', handleEmailSignup);
                googleLoginBtn.addEventListener('click', handleGoogleLogin);
                guestLoginBtn.addEventListener('click', handleGuestLogin);

                // --- Functions ---
                async function handleAuth(authPromise, isNewUserCheck = false) {
                    errorMessage.style.display = 'none';
                    try {
                        const result = await authPromise;
                        const user = result.user;
                        
                        if (isNewUserCheck && !user.isAnonymous) {
                            const userDocRef = db.collection("members").doc(user.uid);
                            const doc = await userDocRef.get();
                            if (!doc.exists) {
                                window.location.href = 'complete-profile.html';
                            }
                            // If user exists, onAuthStateChanged will redirect.
                        }
                    } catch (error) {
                        handleAuthError(error);
                    }
                }

                function handleEmailLogin(e) { e.preventDefault(); handleAuth(auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)); }
                function handleEmailSignup() { handleAuth(auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value), true); }
                function handleGoogleLogin() { handleAuth(auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()), true); }
                function handleGuestLogin() { handleAuth(auth.signInAnonymously()); }

                function handleAuthError(error) {
                    console.error("Authentication Error:", error.code, error.message);
                    let message = "একটি সমস্যা হয়েছে। অনুগ্রহ করে আবার চেষ্টা করুন।";
                    switch (error.code) {
                        case 'auth/wrong-password': case 'auth/user-not-found': message = "ইমেইল বা পাসওয়ার্ড সঠিক নয়।"; break;
                        case 'auth/email-already-in-use': message = "এই ইমেইল দিয়ে ইতিমধ্যে অ্যাকাউন্ট তৈরি করা আছে।"; break;
                        case 'auth/weak-password': message = "পাসওয়ার্ড কমপক্ষে ৬ অক্ষরের হতে হবে।"; break;
                        case 'auth/invalid-email': message = "অনুগ্রহ করে একটি সঠিক ইমেইল দিন।"; break;
                    }
                    errorMessage.textContent = message;
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                console.error("Firebase Initialization Failed:", error);
                pageLoader.innerHTML = `<p style="color:red; font-weight:bold;">সিস্টেম চালু হতে সমস্যা হচ্ছে। অ্যাডমিনের সাথে যোগাযোগ করুন।</p>`;
            }
        });
    </script>
</body>
</html>
