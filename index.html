<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>লগইন - হিজলী দিঘাপাড়া যুব সংঘ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap');
        :root { --primary-color: #16a085; --secondary-color: #27ae60; --dark-text: #2c3e50; --light-text: #7f8c8d; --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); --error-color: #e74c3c; --success-color: #27ae60; --info-color: #3498db; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Hind Siliguri', sans-serif; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        #page-loader { color: white; text-align: center; }
        .spinner { border: 5px solid rgba(255, 255, 255, 0.3); border-top: 5px solid #fff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .login-container { background-color: white; border-radius: 15px; box-shadow: var(--card-shadow); width: 100%; max-width: 420px; display: none; }
        .header { padding: 30px; text-align: center; }
        .header h1 { font-size: 1.8rem; margin-bottom: 5px; }
        .highlight { color: var(--primary-color); background: linear-gradient(to right, #1abc9c, #16a085); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; }
        .header p { font-size: 0.9rem; color: var(--light-text); }
        .header .established { display: inline-block; background-color: #ecf0f1; color: var(--dark-text); padding: 5px 15px; border-radius: 15px; font-weight: 500; margin-top: 10px; font-size: 0.9rem; }
        .main-content { padding: 30px; }
        .form-control { margin-bottom: 5px; position: relative; }
        .form-control i.fa-solid { position: absolute; left: 15px; top: 14px; color: var(--light-text); }
        .form-control .toggle-password { position: absolute; right: 15px; top: 12px; color: var(--light-text); cursor: pointer; }
        .form-control input { width: 100%; padding: 12px 15px 12px 45px; border: 1px solid #ddd; border-radius: 8px; font-family: 'Hind Siliguri', sans-serif; font-size: 1rem; }
        .form-control input:focus { outline: none; border-color: var(--primary-color); }
        .form-guideline { font-size: 0.8rem; color: var(--light-text); text-align: left; margin-bottom: 15px; margin-left: 5px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; color: white; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        .btn-primary { background-color: var(--primary-color); }
        #toggle-mode-btn { background: none; color: var(--primary-color); font-weight: 500; text-align: center; display: block; width: 100%; cursor: pointer; border: none; font-size: 1rem; padding: 10px 0; }
        .alternative-login { text-align: center; margin-top: 25px; }
        .alternative-login p { color: var(--light-text); margin-bottom: 15px; position: relative; }
        .alternative-login p::before, .alternative-login p::after { content: ''; position: absolute; top: 50%; width: 35%; height: 1px; background-color: #ddd; }
        .alternative-login p::before { left: 0; } .alternative-login p::after { right: 0; }
        .btn-group { display: flex; gap: 15px; }
        .btn-alt { flex: 1; padding: 10px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px; border: 1px solid #ddd; }
        .btn-google { background-color: #fff; color: #db4437; }
        .btn-guest { background-color: #fff; color: var(--dark-text); }
        .footer { text-align: center; padding: 20px; background-color: #f8f9fa; border-top: 1px solid #eee; color: var(--light-text); font-size: 0.9rem; }
        .message-box { text-align: center; margin-top: 15px; font-weight: 500; display: none; padding: 12px; border-radius: 8px; line-height: 1.5; }
        .error-message { color: var(--error-color); background-color: #fadbd8; }
        .success-message { color: var(--success-color); background-color: #d4efdf; }
        .info-message { color: #2980b9; background-color: #d6eaf8; }
        .resend-link { color: var(--primary-color); font-weight: bold; cursor: pointer; text-decoration: underline; }
        .loader-small { width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.4); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
    </style>
</head>
<body>
    <div id="page-loader"><div class="spinner"></div><p>সংযোগ স্থাপন করা হচ্ছে...</p></div>
    <div class="login-container" id="login-container">
        <header class="header"><h1><span class="highlight">হিজলী দিঘাপাড়া যুব সংঘ</span></h1><p>হিজলী দিঘাপাড়া, বাগাতিপাড়া, নাটোর</p><div class="established">স্থাপিত: ২০২৬</div></header>
        <main class="main-content" id="main-content">
            <h2 id="form-title" style="text-align:center; color: var(--dark-text); margin-bottom:20px;">লগইন করুন</h2>
            <form id="auth-form">
                <div class="form-control"><i class="fa-solid fa-envelope"></i><input type="email" id="email" placeholder="ইমেইল দিন" required></div>
                <p class="form-guideline">আপনার একটি ভ্যালিড ইমেইল দিন।</p>
                <div class="form-control"><i class="fa-solid fa-lock"></i><input type="password" id="password" placeholder="পাসওয়ার্ড দিন" required><i class="fa-solid fa-eye toggle-password"></i></div>
                <p class="form-guideline">কমপক্ষে ৬ অক্ষরের পাসওয়ার্ড দিন।</p>
                <div id="confirm-password-group" style="display: none;">
                    <div class="form-control"><i class="fa-solid fa-lock"></i><input type="password" id="confirm-password" placeholder="পুনরায় পাসওয়ার্ড দিন"><i class="fa-solid fa-eye toggle-password"></i></div>
                    <p class="form-guideline">নিশ্চিত হওয়ার জন্য পাসওয়ার্ডটি আবার টাইপ করুন।</p>
                </div>
                <button type="submit" class="btn btn-primary" id="submit-btn">লগইন করুন</button>
            </form>
            <button id="toggle-mode-btn">অ্যাকাউন্ট নেই? তৈরি করুন</button>
            <div class="message-box" id="message-box"></div>
            <div class="alternative-login">
                <p>অথবা</p>
                <div class="btn-group">
                    <button class="btn-alt btn-google" id="google-login-btn"><i class="fab fa-google"></i><span>Google</span></button>
                    <button class="btn-alt btn-guest" id="guest-login-btn"><i class="fas fa-user-secret"></i><span>Guest</span></button>
                </div>
            </div>
        </main>
        <footer class="footer">সর্বস্বত্ব সংরক্ষিত © ২০২৬ হিজলী দিঘাপাড়া যুব সংঘ</footer>
    </div>
    <div class="login-container" id="success-container" style="display: none; padding: 40px; text-align:center;">
        <i class="fas fa-envelope-circle-check" style="color: var(--success-color); font-size: 50px;"></i>
        <h2 style="color: var(--success-color); margin-top:20px;">অ্যাকাউন্ট সফলভাবে তৈরি হয়েছে!</h2>
        <p id="success-message" style="color: var(--dark-text); font-size: 1.1rem; line-height: 1.6;">আপনার প্রোফাইল তৈরির প্রক্রিয়া প্রায় শেষ। আপনার ইমেইল ইনবক্সে একটি ভেরিফিকেশন লিংক পাঠানো হয়েছে। অনুগ্রহ করে লিংকে ক্লিক করে আপনার অ্যাকাউন্টটি সক্রিয় করুন।</p>
        <button class="btn btn-primary" style="margin-top: 20px;" onclick="window.location.reload()">লগইন পেজে ফিরে যান</button>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const firebaseConfig = { apiKey: "AIzaSyDerc9e0-e7WBnkK2GoinFejp7zszXJ3Jc", authDomain: "songho-8ef5c.firebaseapp.com", projectId: "songho-8ef5c", storageBucket: "songho-8ef5c.appspot.com", messagingSenderId: "489031747232", appId: "1:489031747232:web:4c1cde63dabaa620ed2bc5", measurementId: "G-5NY15E3XJJ" };
            
            const pageLoader = document.getElementById('page-loader');
            const loginContainer = document.getElementById('login-container');
            const successContainer = document.getElementById('success-container');
            const authForm = document.getElementById('auth-form');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const confirmPasswordGroup = document.getElementById('confirm-password-group');
            const confirmPasswordInput = document.getElementById('confirm-password');
            const googleLoginBtn = document.getElementById('google-login-btn');
            const guestLoginBtn = document.getElementById('guest-login-btn');
            const messageBox = document.getElementById('message-box');
            const toggleModeBtn = document.getElementById('toggle-mode-btn');
            const formTitle = document.getElementById('form-title');
            const submitBtn = document.getElementById('submit-btn');

            let isLoginMode = true;
            let unverifiedUser = null;

            try {
                const app = firebase.initializeApp(firebaseConfig);
                const auth = firebase.auth();
                const db = firebase.firestore();

                auth.onAuthStateChanged(user => {
                    if (user && (user.emailVerified || user.isAnonymous)) {
                        window.location.replace('user.html');
                    } else {
                        pageLoader.style.display = 'none';
                        loginContainer.style.display = 'block';
                    }
                });

                authForm.addEventListener('submit', handleFormSubmit);
                googleLoginBtn.addEventListener('click', handleGoogleLogin);
                guestLoginBtn.addEventListener('click', handleGuestLogin);
                toggleModeBtn.addEventListener('click', toggleMode);
                document.querySelectorAll('.toggle-password').forEach(item => {
                    item.addEventListener('click', e => {
                        const input = e.target.closest('.form-control').querySelector('input');
                        input.type = input.type === 'password' ? 'text' : 'password';
                        e.target.classList.toggle('fa-eye'); e.target.classList.toggle('fa-eye-slash');
                    });
                });

                function toggleMode() {
                    isLoginMode = !isLoginMode;
                    showMessage('');
                    authForm.reset();
                    formTitle.textContent = isLoginMode ? 'লগইন করুন' : 'অ্যাকাউন্ট তৈরি করুন';
                    submitBtn.innerHTML = isLoginMode ? 'লগইন করুন' : 'অ্যাকাউন্ট তৈরি করুন';
                    toggleModeBtn.textContent = isLoginMode ? 'অ্যাকাউন্ট নেই? তৈরি করুন' : 'ইতিমধ্যে অ্যাকাউন্ট আছে? লগইন করুন';
                    confirmPasswordGroup.style.display = isLoginMode ? 'none' : 'block';
                }

                function handleFormSubmit(e) {
                    e.preventDefault();
                    toggleLoading(true);
                    if (isLoginMode) handleLogin(); else handleSignup();
                }

                async function handleLogin() {
                    try {
                        const userCredential = await auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value);
                        if (!userCredential.user.emailVerified) {
                            unverifiedUser = userCredential.user;
                            await auth.signOut();
                            showMessage("আপনার ইমেইল ভেরিফাই করা হয়নি। অনুগ্রহ করে ইনবক্স চেক করুন। <span class='resend-link' onclick='resendVerification()'>আবার পাঠান</span>", 'error');
                        }
                    } catch (error) { handleAuthError(error); } 
                    finally { toggleLoading(false); }
                }
                
                async function handleSignup() {
                    if (passwordInput.value !== confirmPasswordInput.value) {
                        showMessage("দুটি পাসওয়ার্ড মেলেনি।", 'error');
                        toggleLoading(false); return;
                    }
                    try {
                        const userCredential = await auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value);
                        await userCredential.user.sendEmailVerification();
                        await auth.signOut();
                        loginContainer.style.display = 'none';
                        successContainer.style.display = 'block';
                    } catch (error) { handleAuthError(error); } 
                    finally { toggleLoading(false); }
                }

                window.resendVerification = async () => {
                    if(unverifiedUser) {
                        try {
                            await unverifiedUser.sendEmailVerification();
                            showMessage("একটি নতুন ভেরিফিকেশন ইমেইল পাঠানো হয়েছে।", 'success');
                        } catch (error) {
                            showMessage("ইমেইল পাঠাতে সমস্যা হয়েছে।", 'error');
                        }
                    }
                }

                async function handleGoogleLogin() {
                     try {
                        const provider = new firebase.auth.GoogleAuthProvider();
                        const result = await auth.signInWithPopup(provider);
                        const user = result.user;
                        const userDocRef = db.collection("members").doc(user.uid);
                        const doc = await userDocRef.get();
                        if (!doc.exists) { window.location.href = 'complete-profile.html'; }
                    } catch(error) { handleAuthError(error); }
                }

                async function handleGuestLogin() { try { await auth.signInAnonymously(); } catch(error) { handleAuthError(error); } }
                
                function handleAuthError(error) {
                    let message = "একটি সমস্যা হয়েছে।";
                    switch (error.code) {
                        case 'auth/wrong-password': message = "আপনার পাসওয়ার্ডটি ভুল হয়েছে।"; break;
                        case 'auth/user-not-found': message = "এই ইমেইল দিয়ে কোনো অ্যাকাউন্ট খুঁজে পাওয়া যায়নি।"; break;
                        case 'auth/email-already-in-use': message = "এই ইমেইল দিয়ে ইতিমধ্যে অ্যাকাউন্ট তৈরি করা আছে।"; break;
                        case 'auth/weak-password': message = "পাসওয়ার্ড কমপক্ষে ৬ অক্ষরের হতে হবে।"; break;
                        case 'auth/invalid-email': message = "অনুগ্রহ করে একটি সঠিক ইমেইল দিন।"; break;
                    }
                    showMessage(message, 'error');
                }

                function showMessage(msg, type = 'error') {
                    messageBox.innerHTML = msg;
                    messageBox.className = `message-box ${type}-message`;
                    messageBox.style.display = msg ? 'block' : 'none';
                }

                function toggleLoading(isLoading) {
                    submitBtn.disabled = isLoading;
                    submitBtn.innerHTML = isLoading ? '<div class="loader-small"></div>' : (isLoginMode ? 'লগইন করুন' : 'অ্যাকাউন্ট তৈরি করুন');
                }
            } catch (error) {
                console.error("Firebase Initialization Failed:", error);
                pageLoader.innerHTML = `<p style="color:red; font-weight:bold;">সিস্টেম চালু হতে সমস্যা হচ্ছে।</p>`;
            }
        });
    </script>
</body>
</html>
